{% extends "layouts/base.html" %}

{% block content %}
<div class="space-y-6 text-slate-900 dark:text-slate-100">

  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold mb-1">شارژ کیف پول</h1>
      <p class="text-sm text-gray-600 dark:text-gray-300">
        مبلغ دلخواه خود را به <strong>تومان</strong> وارد کنید؛ معادل آن به <strong>ریال</strong> در کیف پول شما شارژ می‌شود.
      </p>
      <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
        هر ۱٬۰۰۰ تومان = ۱۰٬۰۰۰ ریال. محاسبات صورتحساب‌ها و کسر هزینه‌ها بر اساس ریال انجام می‌شود.
      </p>
    </div>
    <div class="text-right">
      <div class="text-xs text-gray-500 dark:text-gray-400">موجودی فعلی</div>
      <div class="text-xl font-bold">
        {{ wallet.balance|default_if_none:"0"|floatformat:0 }} ریال
      </div>
    </div>
  </div>

  <!-- نمایش تعرفه‌ها -->
  <div class="bg-white dark:bg-slate-900 rounded-xl p-4 shadow text-sm space-y-3">
    <h2 class="text-lg font-semibold mb-2">تعرفه‌های محاسبه هر صورتحساب</h2>

    {% if tiers %}
      <ul class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-200">
        {% for tier in tiers %}
          {% widthratio tier.price 10 1 as price_toman %}
          <li>
            {% if tier.max_rows %}
              از {{ tier.min_rows }} تا {{ tier.max_rows }} ردیف:
            {% else %}
              بیشتر از {{ tier.min_rows }} ردیف:
            {% endif %}
            <strong>{{ price_toman }} تومان</strong>
            <span class="text-xs text-gray-500 dark:text-gray-400">
              ({{ tier.price|floatformat:0 }} ریال)
            </span>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-gray-600 dark:text-gray-300">
        هنوز هیچ تعرفه‌ای ثبت نشده است. لطفاً از طریق پنل ادمین، تعرفه‌ها را در مدل PricingTier تعریف کنید.
      </p>
    {% endif %}
  </div>

  <!-- فرم انتخاب مبلغ شارژ -->
  <div class="bg-white dark:bg-slate-900 rounded-xl p-4 shadow text-sm space-y-4">
    <h2 class="text-lg font-semibold mb-2">انتخاب مبلغ شارژ</h2>

    <form method="post" class="space-y-3">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ next }}">

      <div>
        <label class="block text-sm font-medium mb-1" for="amount_toman">
          مبلغ شارژ (به تومان)
        </label>
        <input
          id="amount_toman"
          name="amount_toman"
          type="number"
          min="1000"
          step="1000"
          value="{{ prefill_amount_toman }}"
          class="w-full md:w-64 border rounded-lg px-3 py-2 text-sm bg-slate-50 dark:bg-slate-800"
          placeholder="مثلاً 89000"
        >
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          معادل ریالی این مبلغ در کیف پول ذخیره می‌شود (مبلغ × ۱۰).
        </p>
      </div>

      <div class="flex flex-wrap gap-2 text-xs">
        <button
          type="submit"
          class="inline-flex items-center px-4 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700"
        >
          پرداخت و شارژ (آزمایشی)
        </button>
        <a
          href="{% url 'digihesabyar:wallet' %}"
          class="inline-flex items-center px-3 py-2 rounded-lg border text-slate-700 dark:text-slate-100"
        >
          بازگشت به کیف پول
        </a>
      </div>
    </form>
  </div>

</div>
{% endblock %}
