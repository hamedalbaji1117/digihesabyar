{% extends "layouts/base.html" %}
{% load humanize %}

{% block content %}
<div class="space-y-6 text-slate-900 dark:text-slate-100" dir="rtl">

  <!-- Ù‡Ø¯Ø± -->
  <div class="bg-gradient-to-r from-blue-50 to-emerald-50 dark:from-slate-800 dark:to-slate-900 rounded-2xl p-6 border border-blue-200 dark:border-slate-700">
    <h1 class="text-2xl md:text-3xl font-extrabold mb-2">
      ğŸ”¢ Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ Ø³ÙˆØ¯ Ùˆ Ø²ÛŒØ§Ù† Ø¯ÛŒØ¬ÛŒâ€ŒØ­Ø³Ø§Ø¨â€ŒÛŒØ§Ø±
    </h1>
    <p class="text-sm md:text-base text-gray-600 dark:text-gray-300 leading-relaxed">
      Ø¨Ø§ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´ØŒ Ø®Ø±ÛŒØ¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒØŒ Ø³ÙˆØ¯ ÛŒØ§ Ø²ÛŒØ§Ù† ÛŒÚ© Ú©Ø§Ù„Ø§ Ø±Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†ÛŒØ¯.
    </p>
  </div>

  <!-- Ø¨Ø®Ø´ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ -->
  <div class="bg-white dark:bg-slate-900 rounded-xl p-6 shadow-lg border border-slate-200 dark:border-slate-800">
    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
      <span class="text-2xl">ğŸ’°</span>
      <span>Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§</span>
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="sale_price" class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´ (Ø±ÛŒØ§Ù„) <span class="text-red-500">*</span>
        </label>
        <input
          id="sale_price"
          type="number"
          min="0"
          step="1000"
          class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          placeholder="Ù…Ø«Ù„Ø§Ù‹ 3,500,000"
          data-calc-input
        >
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´ Ú©Ø§Ù„Ø§ Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ</p>
      </div>

      <div>
        <label for="purchase_price" class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ (Ø±ÛŒØ§Ù„) <span class="text-red-500">*</span>
        </label>
        <input
          id="purchase_price"
          type="number"
          min="0"
          step="1000"
          class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          placeholder="Ù…Ø«Ù„Ø§Ù‹ 2,100,000"
          data-calc-input
        >
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ Ú©Ø§Ù„Ø§ Ø§Ø² ØªØ§Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡</p>
      </div>
    </div>

    <!-- Ù†ÙˆØ¹ ÙØ±ÙˆØ´ -->
    <div class="mt-5">
      <span class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
        Ù†ÙˆØ¹ ÙØ±ÙˆØ´
      </span>
      <div class="flex flex-wrap items-center gap-4 text-sm">
        <label class="inline-flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition">
          <input
            type="radio"
            name="sale_type"
            value="cash"
            class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"
            checked
            data-calc-input
          >
          <span class="font-medium">ğŸ’µ ÙØ±ÙˆØ´ Ù†Ù‚Ø¯ÛŒ</span>
        </label>
        <label class="inline-flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition">
          <input
            type="radio"
            name="sale_type"
            value="credit"
            class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"
            data-calc-input
          >
          <span class="font-medium">ğŸ’³ ÙØ±ÙˆØ´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ (Ø¨Ø§ Ø¯Ø±Ø¢Ù…Ø¯ ØªÙˆØ³Ø¹Ù‡ Ù¾Ù„ØªÙØ±Ù…)</span>
        </label>
      </div>
    </div>

    <!-- Ø¯Ø±ØµØ¯ Ø¯Ø±Ø¢Ù…Ø¯ ØªÙˆØ³Ø¹Ù‡ Ù¾Ù„ØªÙØ±Ù… (ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ ÙØ±ÙˆØ´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ Ø§Ø³Øª) -->
    <div id="platform_dev_percent_wrapper" class="mt-4 hidden">
      <label for="platform_dev_percent" class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
        Ø¯Ø±ØµØ¯ Ø¯Ø±Ø¢Ù…Ø¯ ØªÙˆØ³Ø¹Ù‡ Ù¾Ù„ØªÙØ±Ù… (ÙØ±ÙˆØ´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ) %
      </label>
      <div class="flex items-center gap-2">
        <input
          id="platform_dev_percent"
          type="number"
          min="0"
          max="100"
          step="0.1"
          value="3"
          class="w-full md:w-32 border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          placeholder="Ù…Ø«Ù„Ø§Ù‹ 3"
          data-calc-input
        >
        <span class="text-sm text-gray-500 dark:text-gray-400">%</span>
      </div>
      <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
        ÙÙ‚Ø· Ø¯Ø± Ø­Ø§Ù„Øª ÙØ±ÙˆØ´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù¾ÛŒØ´â€ŒÙØ±Ø¶: 3%
      </p>
    </div>
  </div>

  <!-- Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¯ÛŒØ¬ÛŒâ€ŒÚ©Ø§Ù„Ø§ -->
  <div class="bg-white dark:bg-slate-900 rounded-xl p-6 shadow-lg border border-slate-200 dark:border-slate-800">
    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
      <span class="text-2xl">ğŸ“¦</span>
      <span>Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØ¬ÛŒâ€ŒÚ©Ø§Ù„Ø§</span>
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label for="commission_percent" class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          Ú©Ù…ÛŒØ³ÛŒÙˆÙ† Ø¯ÛŒØ¬ÛŒâ€ŒÚ©Ø§Ù„Ø§ (%)
        </label>
        <div class="flex items-center gap-2">
          <input
            id="commission_percent"
            type="number"
            min="0"
            max="100"
            step="0.1"
            class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            placeholder="Ù…Ø«Ù„Ø§Ù‹ 10"
            data-calc-input
          >
          <span class="text-sm text-gray-500 dark:text-gray-400">%</span>
        </div>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Ø¯Ø±ØµØ¯ Ú©Ù…ÛŒØ³ÛŒÙˆÙ† Ø§Ø² Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´</p>
      </div>

      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´
        </label>
        <input
          id="shipping_processing_display"
          type="text"
          class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-slate-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 font-semibold"
          readonly
          value="Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯..."
        >
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          Û·Ùª Ø§Ø² ÙØ±ÙˆØ´ØŒ Ø­Ø¯Ø§Ù‚Ù„ Û²Û²Ûµ,Û°Û°Û° Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Û±,ÛµÛ°Û°,Û°Û°Û° Ø±ÛŒØ§Ù„
        </p>
      </div>

      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          Ù…Ø§Ù„ÛŒØ§Øª Ø¨Ø± Ø§Ø±Ø²Ø´ Ø§ÙØ²ÙˆØ¯Ù‡ Ø®Ø¯Ù…Ø§Øª
        </label>
        <input
          id="vat_display"
          type="text"
          class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-slate-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 font-semibold"
          readonly
          value="Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯..."
        >
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          Û±Û°Ùª Ã— (Ú©Ù…ÛŒØ³ÛŒÙˆÙ† + Ù†ØµÙ Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´)
        </p>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          Ø¯Ø±Ø¢Ù…Ø¯ ØªÙˆØ³Ø¹Ù‡ Ù¾Ù„ØªÙØ±Ù… (Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ)
        </label>
        <input
          id="platform_dev_display"
          type="text"
          class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-slate-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 font-semibold"
          readonly
          value="0 Ø±ÛŒØ§Ù„"
        >
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
        </p>
      </div>
    </div>
  </div>

  <!-- Ø³Ø§ÛŒØ± Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ (Ø¨Ø§Ø²Ø´ÙˆÙ†Ø¯Ù‡) -->
  <div class="bg-white dark:bg-slate-900 rounded-xl p-6 shadow-lg border border-slate-200 dark:border-slate-800">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold flex items-center gap-2">
        <span class="text-2xl">ğŸ“‹</span>
        <span>Ø³Ø§ÛŒØ± Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</span>
      </h2>
      <button
        type="button"
        id="toggle-extra"
        class="text-xs px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 transition font-medium"
      >
        <span id="toggle-extra-text">Ù†Ù…Ø§ÛŒØ´</span> / Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù†
      </button>
    </div>

    <div id="extra_costs" class="space-y-4 hidden">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label for="warehouse_cost" class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
            Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø§Ù†Ø¯Ú¯Ø§Ø±ÛŒ Ø¯Ø± Ø§Ù†Ø¨Ø§Ø± (Ø±ÛŒØ§Ù„)
          </label>
          <input
            id="warehouse_cost"
            type="number"
            min="0"
            step="1000"
            class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            placeholder="Ù…Ø«Ù„Ø§Ù‹ 50,000"
            data-calc-input
          >
        </div>

        <div>
          <span class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
            Ù‡Ø²ÛŒÙ†Ù‡ Ù„ÛŒØ¨Ù„ Ø¯ÛŒØ¬ÛŒâ€ŒÚ©Ø§Ù„Ø§
          </span>
          <div class="space-y-2 mb-2">
            <label class="inline-flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition">
              <input
                type="radio"
                name="label_type"
                value="digikala"
                class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"
                checked
                data-calc-input
              >
              <span class="text-sm font-medium">Ú†Ø§Ù¾ ØªÙˆØ³Ø· Ø¯ÛŒØ¬ÛŒâ€ŒÚ©Ø§Ù„Ø§ (66,000 Ø±ÛŒØ§Ù„)</span>
            </label>
            <label class="inline-flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition">
              <input
                type="radio"
                name="label_type"
                value="seller"
                class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"
                data-calc-input
              >
              <span class="text-sm font-medium">Ú†Ø§Ù¾ ØªÙˆØ³Ø· ÙØ±ÙˆØ´Ù†Ø¯Ù‡</span>
            </label>
          </div>
          <input
            id="label_seller_price"
            type="number"
            min="0"
            step="1000"
            class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            placeholder="Ù¾ÛŒØ´â€ŒÙØ±Ø¶ 10,000"
            value="10000"
            data-calc-input
            disabled
          >
        </div>

        <div>
          <label for="packaging_cost" class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
            Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ÙØ±ÙˆØ´Ù†Ø¯Ù‡ (Ø±ÛŒØ§Ù„)
          </label>
          <input
            id="packaging_cost"
            type="number"
            min="0"
            step="1000"
            class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            placeholder="Ù…Ø«Ù„Ø§Ù‹ 20,000"
            data-calc-input
          >
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label for="logistics_cost" class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
            Ù‡Ø²ÛŒÙ†Ù‡ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„ (ÙØ±ÙˆØ´Ù†Ø¯Ù‡) (Ø±ÛŒØ§Ù„)
          </label>
          <input
            id="logistics_cost"
            type="number"
            min="0"
            step="1000"
            class="w-full border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            placeholder="Ù…Ø«Ù„Ø§Ù‹ 30,000"
            data-calc-input
          >
        </div>
      </div>
    </div>
  </div>

  <!-- Ù†ØªÛŒØ¬Ù‡ -->
  <div class="bg-gradient-to-r from-emerald-50 to-blue-50 dark:from-slate-800 dark:to-slate-900 rounded-xl p-6 shadow-lg border-2 border-emerald-200 dark:border-slate-700">
    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
      <span class="text-2xl">ğŸ“Š</span>
      <span>Ù†ØªÛŒØ¬Ù‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª</span>
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-white dark:bg-slate-800 rounded-lg p-4 shadow-sm border border-slate-200 dark:border-slate-700">
        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Ø¬Ù…Ø¹ Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</div>
        <div id="total_costs_display" class="text-xl font-bold text-slate-900 dark:text-slate-100">
          0 Ø±ÛŒØ§Ù„
        </div>
      </div>
      <div class="bg-white dark:bg-slate-800 rounded-lg p-4 shadow-sm border border-slate-200 dark:border-slate-700">
        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Ø³ÙˆØ¯ / Ø²ÛŒØ§Ù†</div>
        <div id="profit_display" class="text-xl font-bold">
          0 Ø±ÛŒØ§Ù„
        </div>
      </div>
      <div class="bg-white dark:bg-slate-800 rounded-lg p-4 shadow-sm border border-slate-200 dark:border-slate-700">
        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Ø¯Ø±ØµØ¯ Ø³ÙˆØ¯ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯</div>
        <div id="profit_percent_display" class="text-xl font-bold text-slate-900 dark:text-slate-100">
          -
        </div>
      </div>
    </div>

    <button
      type="button"
      id="toggle-details"
      class="mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-700 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 transition"
    >
      <span id="toggle-details-text">Ù†Ù…Ø§ÛŒØ´</span> Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­Ø§Ø³Ø¨Ø§Øª
      <span id="toggle-details-icon">â–¼</span>
    </button>

    <div id="details_panel" class="mt-4 bg-white dark:bg-slate-800 rounded-lg p-4 border border-slate-200 dark:border-slate-700 hidden">
      <h3 class="text-sm font-semibold mb-3 text-slate-900 dark:text-slate-100">Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­Ø§Ø³Ø¨Ø§Øª:</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-xs">
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´:</span>
          <span id="detail_sale_price" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯:</span>
          <span id="detail_purchase_price" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ú©Ù…ÛŒØ³ÛŒÙˆÙ† Ø¯ÛŒØ¬ÛŒâ€ŒÚ©Ø§Ù„Ø§:</span>
          <span id="detail_commission" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´:</span>
          <span id="detail_shipping_processing" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ù…Ø§Ù„ÛŒØ§Øª Ø¨Ø± Ø§Ø±Ø²Ø´ Ø§ÙØ²ÙˆØ¯Ù‡:</span>
          <span id="detail_vat" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ø¯Ø±Ø¢Ù…Ø¯ ØªÙˆØ³Ø¹Ù‡ Ù¾Ù„ØªÙØ±Ù…:</span>
          <span id="detail_platform_dev" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø§Ù†Ø¯Ú¯Ø§Ø±ÛŒ Ø¯Ø± Ø§Ù†Ø¨Ø§Ø±:</span>
          <span id="detail_warehouse" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ù‡Ø²ÛŒÙ†Ù‡ Ù„ÛŒØ¨Ù„:</span>
          <span id="detail_label" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</span>
          <span id="detail_packaging" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400">Ù‡Ø²ÛŒÙ†Ù‡ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„:</span>
          <span id="detail_logistics" class="font-semibold text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1 border-b border-slate-200 dark:border-slate-700">
          <span class="text-gray-600 dark:text-gray-400 font-semibold">Ø¬Ù…Ø¹ Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§:</span>
          <span id="detail_total_costs" class="font-bold text-lg text-slate-900 dark:text-slate-100">0</span>
        </div>
        <div class="flex justify-between py-1">
          <span class="text-gray-600 dark:text-gray-400 font-semibold">Ø³ÙˆØ¯ / Ø²ÛŒØ§Ù† Ù†Ù‡Ø§ÛŒÛŒ:</span>
          <span id="detail_profit" class="font-bold text-lg">0</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function parseNumber(value) {
    if (!value || value === "") return 0;
    const cleaned = String(value).replace(/,/g, "").replace(/Ù¬/g, "").trim();
    const num = Number(cleaned);
    return isNaN(num) ? 0 : num;
  }

  function formatNumber(value) {
    const num = Math.round(Number(value) || 0);
    return num.toLocaleString("fa-IR");
  }

  function formatCurrency(value) {
    return formatNumber(value) + " Ø±ÛŒØ§Ù„";
  }

  function recalc() {
    const salePrice = parseNumber(document.getElementById("sale_price").value);
    const purchasePrice = parseNumber(document.getElementById("purchase_price").value);
    const commissionPercent = parseNumber(document.getElementById("commission_percent").value);
    const platformDevPercent = parseNumber(document.getElementById("platform_dev_percent").value);

    const saleType = document.querySelector('input[name="sale_type"]:checked')?.value || "cash";

    // Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ Ø¯Ø±ØµØ¯ ØªÙˆØ³Ø¹Ù‡ Ù¾Ù„ØªÙØ±Ù…
    const percentWrapper = document.getElementById("platform_dev_percent_wrapper");
    if (percentWrapper) {
      if (saleType === "credit") {
        percentWrapper.classList.remove("hidden");
      } else {
        percentWrapper.classList.add("hidden");
      }
    }

    const warehouseCost = parseNumber(document.getElementById("warehouse_cost")?.value || 0);
    const packagingCost = parseNumber(document.getElementById("packaging_cost")?.value || 0);
    const logisticsCost = parseNumber(document.getElementById("logistics_cost")?.value || 0);

    const labelType = document.querySelector('input[name="label_type"]:checked')?.value || "digikala";
    const labelSellerInput = document.getElementById("label_seller_price");

    let labelCost = 0;
    if (labelType === "digikala") {
      labelCost = 66000;
      if (labelSellerInput) {
        labelSellerInput.disabled = true;
        labelSellerInput.value = "66000";
      }
    } else {
      if (labelSellerInput) {
        labelSellerInput.disabled = false;
        if (!labelSellerInput.value || labelSellerInput.value === "66000") {
          labelSellerInput.value = "10000";
        }
        labelCost = parseNumber(labelSellerInput.value) || 0;
      }
    }

    // Ù…Ø­Ø§Ø³Ø¨Ø§Øª
    const commissionAmount = (salePrice * commissionPercent) / 100;

    // Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´: Û·Ùª Ø§Ø² ÙØ±ÙˆØ´ØŒ Ø­Ø¯Ø§Ù‚Ù„ Û²Û²Ûµ,Û°Û°Û° Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Û±,ÛµÛ°Û°,Û°Û°Û°
    let shippingProcessing = salePrice * 0.07;
    if (shippingProcessing < 225000) shippingProcessing = 225000;
    if (shippingProcessing > 1500000) shippingProcessing = 1500000;

    // Ù…Ø§Ù„ÛŒØ§Øª: Û±Û°Ùª Ã— (Ú©Ù…ÛŒØ³ÛŒÙˆÙ† + Ù†ØµÙ Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´)
    const vat = 0.10 * (commissionAmount + shippingProcessing / 2);

    // Ø¯Ø±Ø¢Ù…Ø¯ ØªÙˆØ³Ø¹Ù‡ Ù¾Ù„ØªÙØ±Ù… (ÙÙ‚Ø· ÙØ±ÙˆØ´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ)
    let platformDev = 0;
    if (saleType === "credit" && platformDevPercent > 0) {
      platformDev = salePrice * (platformDevPercent / 100);
    }

    // Ø¬Ù…Ø¹ Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
    const totalCosts =
      purchasePrice +
      commissionAmount +
      shippingProcessing +
      vat +
      platformDev +
      warehouseCost +
      labelCost +
      packagingCost +
      logisticsCost;

    // Ø³ÙˆØ¯ / Ø²ÛŒØ§Ù†
    const profit = salePrice - totalCosts;

    // Ø¯Ø±ØµØ¯ Ø³ÙˆØ¯ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯
    let profitPercentText = "-";
    if (purchasePrice > 0) {
      const percent = (profit / purchasePrice) * 100;
      profitPercentText = percent.toFixed(1) + "Ùª";
    }

    // Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡
    document.getElementById("shipping_processing_display").value = formatCurrency(Math.round(shippingProcessing));
    document.getElementById("vat_display").value = formatCurrency(Math.round(vat));
    document.getElementById("platform_dev_display").value = formatCurrency(Math.round(platformDev));

    const totalCostsEl = document.getElementById("total_costs_display");
    const profitEl = document.getElementById("profit_display");
    const profitPercentEl = document.getElementById("profit_percent_display");

    totalCostsEl.textContent = formatCurrency(Math.round(totalCosts));
    
    // Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†
    if (profit > 0) {
      profitEl.textContent = formatCurrency(Math.round(profit));
      profitEl.className = "text-xl font-bold text-emerald-600 dark:text-emerald-400";
      profitPercentEl.textContent = profitPercentText;
      profitPercentEl.className = "text-xl font-bold text-emerald-600 dark:text-emerald-400";
    } else if (profit < 0) {
      profitEl.textContent = formatCurrency(Math.round(profit));
      profitEl.className = "text-xl font-bold text-red-600 dark:text-red-400";
      profitPercentEl.textContent = profitPercentText;
      profitPercentEl.className = "text-xl font-bold text-red-600 dark:text-red-400";
    } else {
      profitEl.textContent = formatCurrency(0);
      profitEl.className = "text-xl font-bold text-gray-600 dark:text-gray-400";
      profitPercentEl.textContent = profitPercentText;
      profitPercentEl.className = "text-xl font-bold text-gray-600 dark:text-gray-400";
    }

    // Ø¬Ø²Ø¦ÛŒØ§Øª
    document.getElementById("detail_sale_price").textContent = formatCurrency(salePrice);
    document.getElementById("detail_purchase_price").textContent = formatCurrency(purchasePrice);
    document.getElementById("detail_commission").textContent = formatCurrency(Math.round(commissionAmount));
    document.getElementById("detail_shipping_processing").textContent = formatCurrency(Math.round(shippingProcessing));
    document.getElementById("detail_vat").textContent = formatCurrency(Math.round(vat));
    document.getElementById("detail_platform_dev").textContent = formatCurrency(Math.round(platformDev));
    document.getElementById("detail_warehouse").textContent = formatCurrency(Math.round(warehouseCost));
    document.getElementById("detail_label").textContent = formatCurrency(Math.round(labelCost));
    document.getElementById("detail_packaging").textContent = formatCurrency(Math.round(packagingCost));
    document.getElementById("detail_logistics").textContent = formatCurrency(Math.round(logisticsCost));
    document.getElementById("detail_total_costs").textContent = formatCurrency(Math.round(totalCosts));
    
    const detailProfitEl = document.getElementById("detail_profit");
    detailProfitEl.textContent = formatCurrency(Math.round(profit));
    if (profit > 0) {
      detailProfitEl.className = "font-bold text-lg text-emerald-600 dark:text-emerald-400";
    } else if (profit < 0) {
      detailProfitEl.className = "font-bold text-lg text-red-600 dark:text-red-400";
    } else {
      detailProfitEl.className = "font-bold text-lg text-gray-600 dark:text-gray-400";
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    const inputs = document.querySelectorAll("[data-calc-input]");
    inputs.forEach((el) => {
      el.addEventListener("input", recalc);
      el.addEventListener("change", recalc);
    });

    const toggleExtra = document.getElementById("toggle-extra");
    if (toggleExtra) {
      toggleExtra.addEventListener("click", function () {
        const box = document.getElementById("extra_costs");
        const text = document.getElementById("toggle-extra-text");
        box.classList.toggle("hidden");
        text.textContent = box.classList.contains("hidden") ? "Ù†Ù…Ø§ÛŒØ´" : "Ù…Ø®ÙÛŒ";
      });
    }

    const toggleDetails = document.getElementById("toggle-details");
    if (toggleDetails) {
      toggleDetails.addEventListener("click", function () {
        const panel = document.getElementById("details_panel");
        const icon = document.getElementById("toggle-details-icon");
        const text = document.getElementById("toggle-details-text");
        panel.classList.toggle("hidden");
        icon.textContent = panel.classList.contains("hidden") ? "â–¼" : "â–²";
        text.textContent = panel.classList.contains("hidden") ? "Ù†Ù…Ø§ÛŒØ´" : "Ù…Ø®ÙÛŒ";
      });
    }

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙˆÙ„ÛŒÙ‡
    recalc();
  });
</script>
{% endblock %}
